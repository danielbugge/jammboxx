
<div class="cards_container container">
  <% @jamms.each do |jam|  %>

  <div class="card">

    <%= link_to "", jamm_path(jam), class: "card-link" %>

    <% if jam.user.picture %>
      <div class="card-left_content hidden-xs" style="background-image: url('<%= cl_image_path jam.user.picture %>')">
      </div>
    <% else %>
      <div class="card-left_content hidden-xs" style="background-image: url(https://course_report_production.s3.amazonaws.com/rich/rich_files/rich_files/1692/s300/le-wagon-logo.png)">
      </div>
    <% end %>


      <div class="card-right_content">

        <div class= "card-top">
          <h3><%= jam.name %></h3>
          <p> <%= jam.date %> </p>
        </div>

        <div class="card-middle-top">
          <div>
            <h4><%= jam.genre.name %></h4>
          </div>
          <div>
            <h4><%= jam.level %></h4>
          </div>
        </div>

        <div class="card-middle">
          <p><em>> <%= jam.address %></em></p>
        </div>

        <div class="line"></div>

        <div class="card-bottom">

          <% jamm_players = 0 %> <!-- COUNTER TO KNOW HOW MANY PLAYER ARE ACTIVE RIGHT NOW IN THE JAMM SESH -->
            <%  JammPlayer.where(jamm_id: jam.id).all.each do |player|  %>

            <!--THIS USES THE FIRST INSTRUMENT OF THE JAMMPLAYER AND PUT IN THE CARD,SHOULD CHANGE WHEN MANUALLY SELECT THE INSTRUMENT -->
            <% instrument_t = player.instrument.instrument_type.name %>
            <!--STORE THE EMAIL OF THE USER -->
            <% email = User.where(id: player.user_id).first.email %>
            <!-- THIS SHOULD BE ICONS...SHOW THE INSTRUMENT OF THE USER AND THE EMAIL -->
            <p class="card-instrument-taken"> <%= cl_image_tag(player.user.picture, width: 70, class: "avatar-large") %> </p>

            <% jamm_players += 1 %>
          <% end %>
          <!-- STORE A VALUE WITH THE NUMBER OF AVAILABLE SPOTS -->
          <% available_spots = jam.max_players - jamm_players %>

          <!-- INJECTS ALL THE AVAILABLE SPOTS AS LINKS TO THE SHOW OF THE PAGE. COULD GO TO THE NEW JAMMPLAYER CONTROLLER ACTION -->
          <% available_spots.times do |av| %>
            <%= link_to jamm_path(jam) do %>
                <%= cl_image_tag("add.png", height: 50, width: 50, crop: "scale", class: "avatar-large plus-icon" )  %>
            <% end %>
          <% end  %>

          <p> Player max <%= jam.max_players %></p>

      </div>




    </div>
      <div class="card-extra-right">
        <p>more info</p>
      </div>
  </div>

  <% end %>
</div>
